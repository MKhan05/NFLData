---
title: "NFLData"
author: "Navin Chandradat, Minhaz Khan, Vincent La, Truman Zheng, Stephen Pereira"
date: "11/13/2018"
output: html_document
---


# Going deep: What Are the Makings of a Prolific Passer in the NFL? 

## Introduction

In any professional sports league (here, being the NFL), one of the things us fans really like to do is rank players in terms of skill. 
One of the most common ways for fans to make an argument for one player being better than another is using advanced statistics, more 
specifically, comparing their player efficiency ratings (PER). This efficiency rating is calculated using the player's per game 
statistics but obviously some statistics should be weighted more than others (i.e. touchdowns should be worth more than number of 
passing attempts.). Our goal in this report is to figure out how exactly the NFL calculates player efficiency rating through the use of techniques learned within this course.


```{r}
library(tidyverse)
library(broom)
```


First to read in and display our data:

```{r}
my_url = "http://www.utsc.utoronto.ca/%7ebutler/c32/qbrating.txt"

qbrating = read.table(my_url, head=T)
qbrating
qbrating2 = qbrating %>% separate(long, c("long", "TD"), 2)
qbrating2
```
Here, our data is a 49 rows by 20 columns data set with categories rankings, player names, teams and various player statistics (i.e. completions, attempts).

Looking at the statistics in the data frame and using our prior knowledge that the qbrating was calculated over the whole season we will only consider the season totals when running our analysis.


Steps:
-Introduction
-Adjust the units of the data before any analysis can be done (b/c its per game not per season or vice versa) *If the stat is per game multiply it by 16 to get the value for the whole season because an NFL season consists of 16 games*
-Potential Residual Plot
-Run a multiple regression
-See which variables are significant
-Run the regression again without the insignificant variables
-Summary/Conclusion


##Plot of Stats against Rating
```{r}
qbrating2 %>% gather(stats,x, c(completions:percent.complete, yards, td:long, twenty.plus:sacks)) %>% 
  ggplot(aes(x=x,y=rating))+geom_point()+facet_wrap(~stats,scales = "free")
```


##Plot of Stats against Rating
```{r}
qbrating %>% gather(stats,x, c(completions:sacks)) %>% 
  ggplot(aes(x=x,y=rating,color = player))+geom_point()+facet_wrap(~stats,scales = "free")
```

## Attempt to do residuals.
```{r}
.remove = qbrating[,-(1:4)]
.remove
model2 = glm(rating~completions+attempts+percent.complete+attempts.game+yards+average.yards+yards.per.game+td+int+first.down+first.down.percent+twenty.plus+forty.plus+sacks, data=.remove)
plot(model2)
residuals = resid(model2)
plot(residuals)
```

## Attempt to do regression:

```{r}
NFL_reg = lm(rating~completions+attempts+percent.complete+yards+td+int+first.down+first.down.percent+twenty.plus+forty.plus+sacks, data=qbrating)
summary(NFL_reg)
```

Only td, int, first.down and first.down.percent have p-values below 0.05. What if we remove twenty.plus (highest p-value)?

```{r}
NFL_reg2 = lm(rating~completions+attempts+percent.complete+yards+td+int+first.down+first.down.percent+forty.plus+sacks, data=qbrating)
summary(NFL_reg2)
```

The value for R-sqaured (0.851) does not change by much, although we do see a shift in p-values. What if we remove forty.plus now?

```{r}
NFL_reg3 = lm(rating~completions+attempts+percent.complete+yards+td+int+first.down+first.down.percent+sacks, data=qbrating)
summary(NFL_reg3)
```

Still not a large change in R-squared. We remove sacks:

```{r}
NFL_reg4 = lm(rating~completions+attempts+percent.complete+yards+td+int+first.down+first.down.percent, data=qbrating)
summary(NFL_reg4)
```

We also drop completions:

```{r}
NFL_reg5 = lm(rating~attempts+percent.complete+yards+td+int+first.down+first.down.percent, data=qbrating)
summary(NFL_reg5)
```

Dropping percent.complete:

```{r}
NFL_reg6 = lm(rating~attempts+yards+td+int+first.down+first.down.percent, data=qbrating)
summary(NFL_reg6)
```

Despite removing many variables, we do not see a significant change in our R-squared. Let us see what happens when we remove attempts:

```{r}
NFL_reg7 = lm(rating~yards+td+int+first.down+first.down.percent, data=qbrating)
summary(NFL_reg7)
```

We see a larger drop in our value of R-squared. Now what if we dropped td?

```{r}
NFL_reg8 = lm(rating~yards+int+first.down+first.down.percent, data=qbrating)
summary(NFL_reg8)
```

All values are significant. We have a R-squared value of 0.8135 (compared to the 0.8511 we started with) which is not much of a drop. 

## Residuals for model 8
```{r}
res = resid(NFL_reg8)
plot(res)
```


```{r}
g=ggplot(NFL_reg6, aes(y=.resid,x=.fitted))+geom_point()

g
```

```{r}
g.2 = ggplot(NFL_reg7, aes(y=.resid,x=.fitted))+geom_point()

g.2
```

```{r}
g3=augment(NFL_reg7, qbrating) %>% gather(stats,x, c(completions:sacks)) %>% 
  ggplot(aes(x=x,y=.resid))+geom_point()+facet_wrap(~stats,scales = "free")

g3
```


## Conclusion

After careful analysis we can see that not all variables provided in the dataset were important in predicting the quarterbacks' effeciency rating. 
